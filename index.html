<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://d3js.org/d3.v5.min.js"></script>
<style>
body {
    font-family: "Lato", sans-serif;
}

.sidenav {
    height: 100%;
    width: 250px;
    position: fixed;
    z-index: 1;
    top: 0;
    left: 0;
    background-color: #111;
    overflow-x: hidden;
    padding-top: 20px;
}

  .bar {
    fill: steelblue;
  }

  .bar:hover {
    fill: brown;
  }

.sidenav a {
    padding: 6px 8px 6px 16px;
    text-decoration: none;
    font-size: 25px;
    color: #818181;
    display: block;
}

.sidenav a:hover {
    color: #f1f1f1;
}

.main {
    margin-left: 32px; /* Same as the width of the sidenav */
    padding: 10px 10px 10px 10px;
}

@media screen and (max-height: 450px) {
    .sidenav {padding-top: 15px;}
    .sidenav a {font-size: 18px;}
}
</style>
</head>
<body>


<div id="main" class="main">
  <h2>Data Visualization: Historical Flood Risk and Costs for New Jersey</h2>
  <div>
  <p>Find the number of flooding Episdoes for each State along the years</p>
</div>

  <span>County: <select id="county"></select></span> <span>State: <select id="dropdown"></select></span>

</div>
  <svg id="bar_svg" width="1200" height="500"></svg>

 <script>    

        dataset = []         

        window.onload = function()
        {

              var svg = d3.select("#bar_svg"),
margin = {
  top: 20,
  right: 20,
  bottom: 30,
  left: 50
},
width = +svg.attr("width") - margin.left - margin.right,
height = +svg.attr("height") - margin.top - margin.bottom,
g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var x = d3.scaleBand()
  .rangeRound([0, width])
  .padding(0.1);

var y = d3.scaleLinear()
  .rangeRound([height, 0]);

  function compare(a,b) {
  if (a.Year < b.Year)
    return -1;
  if (a.Year > b.Year)
    return 1;
  return 0;
}


              d3.csv("DataVizFloodsNJonly/NOAA-Table 1.csv").then(function(data) {  

                  d_New_Jersey = [];
                  var len = data.length;
                  for (var i = 0; i < len; i++) {
                    if(data[i].State == "New Jersey"){
                      d_New_Jersey.push(data[i]);
                    }
                  }

                  data = d_New_Jersey;  

                  data.sort(compare);

                  dataset = data;
                  d1 = [];
                  d_2 = [];
                  var arrayLength = dataset.length;
                  for (var i = 0; i < arrayLength; i++) {
                    d1.push(dataset[i].State);
                    d_2.push(dataset[i].County);
                  }

                  d1 = Array.from(new Set(d1));
                  d_2 = Array.from(new Set(d_2));
                  console.log(d_2);

                  d3.select("#dropdown")
                  .selectAll("option")
                  .data(d1)
                  .enter()
                  .append("option")
                  .attr("value", function(option) { return option; })
                  .text(function(option) { return option; });

                  d3.select("#county")
                  .selectAll("option")
                  .data(d_2)
                  .enter()
                  .append("option")
                  .attr("value", function(option) { return option; })
                  .text(function(option) { return option; });

                  d = data;

                  data = [];
                  arrayLength = d.length;
                  for (var i = 0; i < arrayLength; i++) {
                    if(d[i].State == d1[0] && d[i].County == d_2[0] && !isNaN(Number(d[i].Year))) {
                      data.push(d[i])
                    }
                  }

                  x.domain(data.map(function (d) {
      return d.Year;
    }));
  y.domain([0, d3.max(data, function (d) {
        return Number(d.NumEpisodes);
      })]);

  g.append("g")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.axisBottom(x))

  g.append("g")
  .call(d3.axisLeft(y))
  .append("text")
  .attr("fill", "#000")
  .attr("transform", "rotate(-90)")
  .attr("y", 6)
  .attr("dy", "0.71em")
  .attr("text-anchor", "end")
  .text("Number of Episodes");

  g.selectAll(".bar")
  .data(data)
  .enter().append("rect")
  .attr("class", "bar")
  .attr("x", function (d) {
    return x(d.Year);
  })
  .attr("y", function (d) {
    return y(Number(d.NumEpisodes));
  })
  .attr("width", x.bandwidth())
  .attr("height", function (d) {
    return height - y(Number(d.NumEpisodes));
  });

              });


               d3.select("#county").on('change', function() {
              var newData = d3.select(this).property('value');
                d1 = []
                var arrayLength = dataset.length;
                    for (var i = 0; i < arrayLength; i++) {

                      if(dataset[i].State == "New Jersey" && dataset[i].County == newData && !isNaN(Number(dataset[i].Year))){
                         d1.push(dataset[i])
                    }
                }

           x.domain(d1.map(function (d) {
      return d.Year;
    }));
  y.domain([0, d3.max(d1, function (d) {
        return Number(d.NumEpisodes);
      })]);

          //Select…
          var bars = svg.selectAll("rect");
          
          //Enter…
          bars.enter()
            .append("rect")
           .attr("x", function (d) {
    return x(d.Year);
  })
  .attr("y", function (d) {
    return y(Number(d.NumEpisodes));
  })
  .attr("width", x.bandwidth())
  .attr("height", function (d) {
    return height - y(Number(d.NumEpisodes));
  })
            .attr("fill", function(d) {
              return "rgb(0, 0, " + (d.NumEpisodes * 10) + ")";
            })
            .merge(bars)  //Update…
            .transition()
            .duration(500)
            .attr("x", function (d) {
    return x(d.Year);
  })
  .attr("y", function (d) {
    return y(Number(d.NumEpisodes));
  })
  .attr("width", x.bandwidth())
  .attr("height", function (d) {
    return height - y(Number(d.NumEpisodes));
  });

          //Exit…
          bars.exit()
            .transition()
            .duration(500)
            .attr("x", -xScale.bandwidth())
            .remove();




              });


      };
       
               
              

            
        </script>
     
</body>
</html> 
